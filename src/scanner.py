import os
import subprocess
import nvd

def run_nmap_scan(target):
    result = subprocess.run(['nmap', '-sV', target], stdout=subprocess.PIPE)
    return result.stdout.decode()

def check_vulnerabilities(nmap_output):
    vulnerabilities = []
    for line in nmap_output.split('\n'):
        if "Service Info" in line:
            service_info = line.split(':')[1].strip()
            cves = nvd.get_cves_for_service(service_info)
            if cves:
                vulnerabilities.append((service_info, cves))
    return vulnerabilities

if __name__ == "__main__":
    target = '127.0.0.1'  # Change this to the target you want to scan
    nmap_output = run_nmap_scan(target)
    vulnerabilities = check_vulnerabilities(nmap_output)
    if vulnerabilities:
        for service, cves in vulnerabilities:
            print(f"Service: {service}")
            for cve in cves:
                print(f"  - {cve}")
    else:
        print("No known vulnerabilities found.")
