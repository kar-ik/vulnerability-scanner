import nmap
from vulners_scanner import get_vulnerabilities

def scan_network(network_range):
    nm = nmap.PortScanner()
    nm.scan(hosts=network_range, arguments='-sV')
    hosts_list = [(x, nm[x]['status']['state'], nm[x]['tcp']) for x in nm.all_hosts()]
    return hosts_list

def check_vulnerabilities(services):
    vulnerabilities = []
    for service in services:
        product = service.get('product', '')
        version = service.get('version', '')
        if product and version:
            vulns = get_vulnerabilities(product, version)
            vulnerabilities.extend(vulns)
    return vulnerabilities

if __name__ == "__main__":
    network_range = input("Enter the network range to scan (e.g., 192.168.1.0/24): ")
    print(f"Scanning network: {network_range}")
    hosts = scan_network(network_range)
    for host, status, services in hosts:
        print(f"\nHost: {host} Status: {status}")
        for port, service in services.items():
            print(f"Port: {port} Service: {service}")
            vulnerabilities = check_vulnerabilities([service])
            if vulnerabilities:
                print("Vulnerabilities found:")
                for vuln in vulnerabilities:
                    print(f"  - {vuln['id']} - {vuln['title']}")
            else:
                print("No vulnerabilities found.")
